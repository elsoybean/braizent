{
  "skill": "add-to-shopping-list",
  "test_cases": [
    {
      "test_id": "shopping-list-01",
      "description": "Chicken and Dumplings for Monday Knuspr delivery",
      "inputs": {
        "meal": "Chicken and Dumplings, Southern Style",
        "meal_date": "2026-01-12",
        "shopping_date": "2026-01-06",
        "recipe_path": "/Users/cmlee/meals/recipes/chicken-and-dumplings-southern/chicken-and-dumplings-southern.md",
        "profile_path": "/Users/cmlee/meals/PROFILE.md",
        "existing_shopping_list": null
      },
      "validation_checks": {
        "store_assignment": {
          "boneless_chicken_thighs": {
            "expected_store": "Knuspr",
            "expected_product": "Pollofino",
            "reason": "Profile specifies Pollofino from Knuspr"
          },
          "flour": {
            "expected_section": "Dry Goods & Pantry",
            "expected_package": "1kg bag minimum"
          },
          "vegetables": {
            "expected_section": "Produce"
          }
        },
        "package_sizes": {
          "flour": {
            "need": "200g",
            "buy": "1kg bag",
            "note": "800g remaining"
          },
          "butter": {
            "need": "100g",
            "buy": "250g package",
            "note": "150g remaining"
          }
        },
        "pantry_filtering": {
          "excluded": ["salt", "pepper", "bay leaves", "chicken schmaltz", "butter (if user has on hand)"],
          "note": "Check PROFILE.md pantry staples"
        },
        "smart_allocation": {
          "scenario": "If shopping list already has butter for another meal",
          "expected": "Claim from existing purchase, don't add duplicate"
        }
      },
      "quality_threshold": 0.90,
      "expected_cost_range": {
        "sonnet_4.5": [0.75, 1.00],
        "haiku": [0.15, 0.25]
      }
    },
    {
      "test_id": "shopping-list-02",
      "description": "Smart allocation - multiple meals sharing ingredients",
      "inputs": {
        "meals": [
          {
            "name": "Wednesday Curry",
            "date": "2026-01-08",
            "needs": ["coconut milk 400ml", "jasmine rice 300g"]
          },
          {
            "name": "Thursday Stir-Fry",
            "date": "2026-01-09",
            "needs": ["jasmine rice 200g", "coconut milk 200ml"]
          }
        ],
        "shopping_date": "2026-01-06",
        "profile_path": "/Users/cmlee/meals/PROFILE.md"
      },
      "validation_checks": {
        "smart_allocation": {
          "coconut_milk": {
            "total_needed": "600ml",
            "buy": "2 x 400ml cans",
            "allocation": "Wed: 400ml, Thurs: 200ml, 200ml remaining",
            "note": "Should show which meal uses what"
          },
          "jasmine_rice": {
            "total_needed": "500g",
            "buy": "1kg bag",
            "allocation": "Wed: 300g, Thurs: 200g, 500g remaining"
          }
        },
        "no_duplicates": {
          "check": "Should not suggest buying coconut milk twice"
        }
      },
      "quality_threshold": 0.90,
      "notes": "Tests smart allocation logic - keep this feature even with Haiku"
    },
    {
      "test_id": "shopping-list-03",
      "description": "Store preferences and specialty items",
      "inputs": {
        "meal": "Thá»‹t Kho (Vietnamese Braised Pork)",
        "meal_date": "2026-01-11",
        "shopping_date": "2026-01-06",
        "recipe_path": "/Users/cmlee/meals/recipes/thit-kho-vietnamese-braised-pork/thit-kho-vietnamese-braised-pork.md",
        "profile_path": "/Users/cmlee/meals/PROFILE.md"
      },
      "validation_checks": {
        "store_assignment": {
          "fish_sauce": {
            "expected_store": "Asian Market OR Rewe",
            "note": "Common enough for Rewe, but Asian Market has better selection"
          },
          "pork_shoulder": {
            "expected_store": "Knuspr (Nackensteaks) OR Rewe",
            "note": "Profile mentions Knuspr has thick-cut pork shoulder steaks"
          }
        },
        "specialty_ingredients": {
          "note": "Should identify if any ingredients only available at Asian Market"
        }
      },
      "quality_threshold": 0.90
    }
  ],
  "optimization_targets": {
    "phase_1": {
      "model": "haiku",
      "modifications": [
        "Add package size lookup table (A4)",
        "Add store section assignment rules (A5)",
        "Keep smart quantity allocation logic (high value)"
      ],
      "expected_savings": "70-80%",
      "critical_features_to_preserve": [
        "Smart allocation across multiple meals",
        "Pantry staple filtering",
        "Profile-aware store preferences (Pollofino from Knuspr, etc.)"
      ]
    }
  }
}
